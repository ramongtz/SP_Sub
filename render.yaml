# render.yaml (Revised for Direct Environment Variables - FOR DEBUGGING)

services:
  # The Python/Gunicorn backend service.
  - type: pserv
    name: backend
    env: docker
    dockerfilePath: ./Dockerfile
    # Set environment variables directly on this service.
    envVars:
      - key: AUTH0_DOMAIN
        value: your-auth0-domain.us.auth0.com # <-- REPLACE
      - key: API_AUDIENCE
        value: https://scorm-processor-api   # <-- REPLACE
      - key: GUNICORN_WORKERS
        value: 4
      - key: PYTHON_VERSION
        value: 3.12

  # The Nginx frontend service.
  - type: web
    name: frontend
    env: docker
    dockerfilePath: ./frontend.Dockerfile
    healthCheckPath: /
    rewrites:
      - source: /api/:path*
        destination: http://backend:8080/api/:path
      - source: /download/:path*
        destination: http://backend:8080/download/:path
      # This final rule serves your single-page app for all other routes
      - source: /*
        destination: /index.html